generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  PLATFORM_ADMIN
  COMPANY_OWNER
  PROPERTY_MANAGER
  MAINTENANCE
  TENANT
}

enum LeaseStatus {
  ACTIVE
  EXPIRED
  TERMINATED
}

enum ChargeStatus {
  PENDING
  PAID
  OVERDUE
}

enum MaintenanceStatus {
  OPEN
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum WorkOrderStatus {
  PENDING
  ASSIGNED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

model Company {
  id        String   @id @default(uuid())
  name      String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  users      CompanyUser[]
  properties Property[]
  tenants    TenantProfile[]
  leases     Lease[]
  charges    Charge[]
  maintenanceRequests MaintenanceRequest[]
  workOrders WorkOrder[]
  ledgerEntries LedgerEntry[]

  @@map("companies")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  companies  CompanyUser[]
  workOrders WorkOrder[]

  @@map("users")
}

model CompanyUser {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  companyId String   @map("company_id")
  role      UserRole

  user    User    @relation(fields: [userId], references: [id])
  company Company @relation(fields: [companyId], references: [id])

  @@unique([userId, companyId])
  @@map("company_users")
}

model Property {
  id        String   @id @default(uuid())
  companyId String   @map("company_id")
  name      String
  address   String
  city      String
  state     String
  zip       String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  company Company @relation(fields: [companyId], references: [id])
  units   Unit[]

  @@map("properties")
}

model Unit {
  id         String   @id @default(uuid())
  companyId  String   @map("company_id")
  propertyId String   @map("property_id")
  number     String
  bedrooms   Int      @default(0)
  bathrooms  Int      @default(0)
  sqft       Int      @default(0)
  rentAmount Float    @default(0) @map("rent_amount")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  property Property @relation(fields: [propertyId], references: [id])
  leases   Lease[]
  maintenanceRequests MaintenanceRequest[]

  @@map("units")
}

model TenantProfile {
  id        String   @id @default(uuid())
  companyId String   @map("company_id")
  email     String
  name      String
  phone     String?
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  company      Company       @relation(fields: [companyId], references: [id])
  leaseTenants LeaseTenant[]
  maintenanceRequests MaintenanceRequest[]

  @@map("tenants")
}

model Lease {
  id        String      @id @default(uuid())
  companyId String      @map("company_id")
  unitId    String      @map("unit_id")
  startDate DateTime    @map("start_date")
  endDate   DateTime    @map("end_date")
  status    LeaseStatus @default(ACTIVE)
  createdAt DateTime    @default(now()) @map("created_at")
  updatedAt DateTime    @updatedAt @map("updated_at")

  company      Company       @relation(fields: [companyId], references: [id])
  unit         Unit          @relation(fields: [unitId], references: [id])
  leaseTenants LeaseTenant[]
  charges      Charge[]

  @@map("leases")
}

model LeaseTenant {
  id       String @id @default(uuid())
  leaseId  String @map("lease_id")
  tenantId String @map("tenant_id")

  lease  Lease         @relation(fields: [leaseId], references: [id])
  tenant TenantProfile @relation(fields: [tenantId], references: [id])

  @@unique([leaseId, tenantId])
  @@map("lease_tenants")
}

model Charge {
  id        String       @id @default(uuid())
  companyId String       @map("company_id")
  leaseId   String       @map("lease_id")
  amount    Float
  dueDate   DateTime     @map("due_date")
  status    ChargeStatus @default(PENDING)
  createdAt DateTime     @default(now()) @map("created_at")
  updatedAt DateTime     @updatedAt @map("updated_at")

  company Company @relation(fields: [companyId], references: [id])
  lease   Lease   @relation(fields: [leaseId], references: [id])

  @@map("charges")
}

model MaintenanceRequest {
  id        String            @id @default(uuid())
  companyId String            @map("company_id")
  unitId    String            @map("unit_id")
  tenantId  String            @map("tenant_id")
  title     String
  description String
  status    MaintenanceStatus @default(OPEN)
  createdAt DateTime          @default(now()) @map("created_at")
  updatedAt DateTime          @updatedAt @map("updated_at")

  company    Company       @relation(fields: [companyId], references: [id])
  unit       Unit          @relation(fields: [unitId], references: [id])
  tenant     TenantProfile @relation(fields: [tenantId], references: [id])
  workOrders WorkOrder[]

  @@map("maintenance_requests")
}

model WorkOrder {
  id               String          @id @default(uuid())
  companyId        String          @map("company_id")
  requestId        String          @map("request_id")
  assignedToUserId String?         @map("assigned_to_user_id")
  status           WorkOrderStatus @default(PENDING)
  notes            String?
  createdAt        DateTime        @default(now()) @map("created_at")
  updatedAt        DateTime        @updatedAt @map("updated_at")

  company Company            @relation(fields: [companyId], references: [id])
  request MaintenanceRequest @relation(fields: [requestId], references: [id])
  assignedTo User?            @relation(fields: [assignedToUserId], references: [id])

  @@map("work_orders")
}

model LedgerEntry {
  id         String   @id @default(uuid())
  companyId  String   @map("company_id")
  refType    String   @map("ref_type")
  refId      String   @map("ref_id")
  amount     Float
  occurredAt DateTime @map("occurred_at")
  createdAt  DateTime @default(now()) @map("created_at")

  company Company @relation(fields: [companyId], references: [id])

  @@map("ledger_entries")
}
